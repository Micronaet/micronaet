<?xml version="1.0" ?>
<openerp>
    <data>
        <!-- TODO put inherit also for privacy_signed check-->
        <record id="view_order_form_original" model="ir.ui.view">
            <field name="name">Sale Order add extra privacy field</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="type">form</field>
            <field name="arch" type="xml">
                   <field name="name" position="after">
                      <field name="print_privacy_policy" invisible="1" />
                   </field>
            </field>
    </record>
        <record id="view_order_form_slim" model="ir.ui.view">
            <field name="name">Sale Order slim</field>
            <field name="model">sale.order</field>
            <field name="priority" eval="20" />            
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Sales Order">
                    <group col="6" colspan="4">
                        <group colspan="4" col="8">
                        <field name="name"/>
                        <field name="date_order"/>
                        <!--<field name="shop_id" on_change="onchange_shop_id(shop_id)" widget="selection"/>-->
                        <field name="client_order_ref"/>
                        <field name="invoiced"/>
                        <!--<field name="shipped"/>-->
                        </group>
                        <newline />
                        <separator colspan="4" string="Print options:" />
                        <group colspan="4" col="8">
                          <field name="print_privacy_policy"/>
                          <field name="print_conditions"/>
                          <field name="print_subtotal_price"/>
                        </group>
                    </group>
                    <notebook colspan="5">
                        <page string="Sales Order">
                            <field name="partner_id" on_change="onchange_partner_id(partner_id)" domain="[('customer','=',True)]" context="{'search_default_customer':1}" required="1"/>
                            <field domain="[('partner_id','=',partner_id)]" name="partner_order_id" invisible="1" />
                            <field domain="[('partner_id','=',partner_id)]" name="partner_shipping_id" groups="base.group_extended" invisible="1" />
                            <field domain="[('partner_id','=',partner_id)]" name="partner_invoice_id" groups="base.group_extended"/>
                            <field domain="[('type','=','sale')]" name="pricelist_id" groups="base.group_extended"/>
                            <!--<field name="project_id"
                                context="{'partner_id':partner_id, 'contact_id':partner_order_id, 'pricelist_id':pricelist_id, 'default_name':name}"
                                groups="analytic.group_analytic_accounting" domain="[('parent_id','!=',False)]" />-->
                            <newline/>
                            <!--Trasformata in bottom-->
                            <field colspan="4" name="order_line" nolabel="1" > <!--mode="tree,form,graph"  widget="one2many_list"-->
                                <tree string="Dettagli" editable="bottom">
                                    <field name="discarded" />
                                    <field context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom"
                                        name="product_id"
                                        on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], True, parent.date_order, product_packaging, parent.fiscal_position, False)"
                                        />
                                    <field name="product_uom"
                                        on_change="product_uom_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order)"/>
                                    <field name="name" />
                                    <!--<field name="tax_id" invisible="1" />-->
                                    <field name='tooth' />
                                    <field name="product_uom_qty" string="Qty"/>
                                    <field name="price_unit"/>
                                    <field name="discount"/>
                                    <field name="price_subtotal"/>
                                    <!--<field name="type" groups="base.group_extended"/>-->
                                    <field name="state"/>
                                    <field name="invoiced"/>
                                    <button colspan="1"
                                          name="%(sale.action_view_sale_order_line_make_invoice)d"
                                          states="confirmed"
                                          string="Make Invoices"
                                          type="action"
                                          icon="terp-document-new" 
                                          attrs="{'invisible':[('invoiced','=',True)]}" />
                                </tree>
                                <form string="Dettagli" editable="bottom">
                                    <field name="discarded" />
                                    <field context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom"
                                        name="product_id"
                                        on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], True, parent.date_order, product_packaging, parent.fiscal_position, False)"
                                        />
                                    <field name="product_uom"
                                        on_change="product_uom_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order)"/>
                                    <field name="name" />
                                    <field name='tooth' />
                                    <field name="product_uom_qty" string="Qty"/>
                                    <field name="price_unit"/>
                                    <field name="discount"/>
                                    <field name="price_subtotal"/>
                                    <!--<field name="type" groups="base.group_extended"/>-->
                                    <group colspan="4" col="5" groups="base.group_extended">
                                        <separator colspan="5" string="States"/>
                                        <field name="state"/>
                                        <field name="invoiced"/>
                                        <group attrs="{'invisible':[('invoiced','=',True)]}">
                                           <button colspan="1"
                                              name="%(sale.action_view_sale_order_line_make_invoice)d"
                                              states="confirmed"
                                              string="Make Invoices"
                                              type="action"
                                              icon="terp-document-new" />
                                           </group>
                                       </group>
                                </form>
                                <!--<tree string="Sales Order Lines">
                                    <field colspan="4" name="name"/>
                                    <field name="product_uom_qty" string="Qty"/>
                                    <field name="product_uom" string="UoM"/>
                                    <field name="discount"/>
                                    <field name="price_unit"/>
                                    <field name="price_subtotal"/>
                                </tree>-->


                                <!--<form string="Sales Order Lines">
                                    <field colspan="4"
                                        context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom"
                                        name="product_id"
                                        on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], True, parent.date_order, product_packaging, parent.fiscal_position, False)"
                                        />
                                    <field>
                                    <field name="product_uom"
                                        on_change="product_uom_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order)"/>
                                    <field colspan="4" name="name"/>
                                    <field name="price_unit"/>
                                    <field name="discount"/>
                                    <field name="type" groups="base.group_extended"/>
                                    <group colspan="4" col="5" groups="base.group_extended">
                                        <separator colspan="5" string="States"/>
                                        <field name="state"/>
                                        <field name="invoiced"/>

                                    </group>
                                </form>    -->

                                <!--<form string="Sales Order Lines">
                                    <notebook>
                                            <field
                                                context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom"
                                                name="product_uom_qty"
                                                on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order, product_packaging, parent.fiscal_position, True)"
                                                />
                                                <field groups="product.group_uos" name="product_uos_qty"/>
                                                <field groups="product.group_uos" name="product_uos"/>

                                            <field
                                                name="product_packaging"
                                                context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom"
                                                on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order, product_packaging, parent.fiscal_position, False)"
                                                domain="[('product_id','=',product_id)]"
                                                groups="base.group_extended"/>

                                            <field name="delay" groups="base.group_extended"/>
                                            <newline/>
                                            <separator colspan="5" string="Taxes"/>
                                            <field colspan="4" name="tax_id" nolabel="1" domain="[('parent_id','=',False),('type_tax_use','&lt;&gt;','purchase')]"/>
                                        </page>
                                        <page groups="base.group_extended" string="Extra Info">
                                            <field name="th_weight"/>
                                            <field name="address_allotment_id"/>
                                            <field name="property_ids" colspan="4"/>
                                        </page>
                                        <page string="Notes">
                                            <field colspan="4" name="notes" nolabel="1"/>
                                        </page>
                                        <page string="History" groups="base.group_extended">
                                            <separator colspan="4" string="Invoice Lines"/>
                                            <field colspan="4" name="invoice_lines" nolabel="1"/>
                                            <separator colspan="4" string="Stock Moves"/>
                                            <field colspan="4" name="move_ids" nolabel="1" widget="many2many"/>
                                        </page>
                                    </notebook>-->
                            </field>
                            <newline/>
                            <group col="14" colspan="10">
                                <field name="amount_untaxed" sum="Untaxed amount"/>
                                <field name="amount_tax"/>
                                <field name="amount_total"/>
                                <button name="button_discard" string="Discard line" type="object" icon="gtk-execute" help="Delete lines discarded but put operation in todo list of partner" confirm="Delete selected discarded line an store as operations todo in partner form, confirm?"/>
                                <button name="button_dummy" states="draft" string="Compute" type="object" icon="gtk-execute"/>
                                <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Advance Invoice"
                                    type="action" icon="gtk-execute" states="draft,manual" groups="base.group_extended"/>
                            </group>
                            <group col="13" colspan="4">
                                <field name="state"/>
                                <button name="invoice_recreate" states="invoice_except" string="Recreate Invoice" icon="gtk-go-forward"/>
                                <button name="invoice_corrected" states="invoice_except" string="Ignore Exception" icon="gtk-apply"/>
                                <button name="ship_recreate" states="shipping_except" string="Recreate Packing" icon="gtk-ok"/>
                                <button name="ship_corrected" states="shipping_except" string="Ignore Exception" icon="gtk-apply"/>
                                <button name="action_cancel" states="manual,progress" string="Cancel Order" type="object" icon="gtk-cancel"/>
                                <button name="manual_invoice" states="manual" string="Create Final Invoice" icon="gtk-go-forward" type="object"/>
                                <button name="ship_cancel" states="shipping_except" string="Cancel Order" icon="gtk-cancel"/>
                                <button name="action_cancel_draft" states="cancel" string="Set to Draft" type="object" icon="gtk-convert"/>
                                <button name="cancel" states="draft" string="Cancel Order" icon="gtk-cancel"/>
                                <button name="invoice_cancel" states="invoice_except" string="Cancel Order" icon="gtk-cancel"/>
                                <button name="order_confirm" states="draft" string="Confirm Order" icon="gtk-apply"/>
                            </group>
                        </page>
                        <page string="Other Information">
                            <!--<group colspan="2" col="2" groups="base.group_extended" name="logistics">
                                <separator string="Logistic" colspan="2"/>
                                <field name="incoterm" widget="selection"/>
                                <field name="picking_policy" required="True"/>
                                <field name="order_policy" on_change="shipping_policy_change(order_policy)"/>
                                <field name="invoice_quantity" attrs="{'readonly':['|',('order_policy','in',['prepaid','picking']),('state','!=','draft')]}"/>
                            </group>
                            <group colspan="2" col="2">
                                <separator string="References" colspan="2"/>
                                <field name="user_id"/>
                                <field groups="base.group_extended" name="origin"/>
                            </group>-->
                            <group colspan="2" col="2" groups="base.group_extended">
                                <separator string="Conditions" colspan="2"/>
                                <field name="payment_term" widget="selection"/>
                                <field name="fiscal_position" widget="selection"/>
                                <field name="company_id" widget="selection" groups="base.group_multi_company"/>
                            </group>
                            <group colspan="2" col="2" groups="base.group_extended">
                                <separator string="Dates" colspan="2"/>
                                <field name="create_date" widget="datetime"/>
                                <field name="date_confirm"/>
                            </group>
                            <separator colspan="4" string="Notes"/>
                            <field colspan="4" name="note" nolabel="1"/>
                        </page>
                        <!--<page string="History" groups="base.group_extended">
                            <separator colspan="4" string="Invoices"/>
                            <field colspan="4" name="invoice_ids" nolabel="1" context="{'form_view_ref':'account.invoice_form'}"/>
                            <separator colspan="4" string="Packings"/>
                            <field colspan="4" name="picking_ids" nolabel="1"/>
                        </page>-->
                    </notebook>
                </form>
            </field>
        </record>

        <record id="action_order_form_slim" model="ir.actions.act_window">
            <field name="name">Sales Orders Slim</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="search_view_id" ref="sale.view_sales_order_filter"/>
            <field name="context">{'search_default_user_id':uid,'form_view_ref':'dentist.view_order_form_slim'}</field>
            <field name="help">Sales Orders help you manage quotations and orders from your customers. OpenERP suggests that you start by creating a quotation. Once it is confirmed, the quotation will be converted into a Sales Order. OpenERP can handle several types of products so that a sales order may trigger tasks, delivery orders, manufacturing orders, purchases and so on. Based on the configuration of the sales order, a draft invoice will be generated so that you just have to confirm it when you want to bill your customer.</field>
        </record>
        <!--<menuitem action="action_order_form" id="menu_sale_order" parent="base.menu_sales" sequence="3" groups="base.group_sale_salesman,base.group_sale_manager"/>-->
        <menuitem name="Lista preventivi" id="dentist_quotation_list_menu_slim" parent="dentist_quotation_menu" action="action_order_form_slim" sequence="1" groups="base.group_sale_salesman,base.group_sale_manager" />
        
    </data>
</openerp>

